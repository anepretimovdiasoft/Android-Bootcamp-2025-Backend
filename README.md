# Android-Bootcamp-2025-Backend
## Команда: Сборная_ЦК_№1

Разработать программный продукт для помощи в осуществлении волонтерской деятельности в клиент-серверной архитектуре.

Клиент - Android Приложение, реализованное на java или kotlin с адаптивной версткой.
Мобильное приложение должно предоставлять удобный и интуитивно понятный интерфейс для волонтеров, в котором можно зарегистрироваться в базу волонтеров, просмотреть ближайшие волонтерские центры, отредактировать собственный профиль и посмотреть активных волонтеров в конкретном центре. В случае авторизации с правами администратора, пользователь приложения должен иметь возможность просмотреть список не занятых волонтеров и их контактные данные.

Сервер - микросервис на Spring Boot, работающий с In-memory базой данных H2.
Серверное приложение должно предоставлять API необходимый для работы мобильного приложения. Осуществлять все основные манипуляции с данными в СУБД при помощи Spring Data JPA. Данные о всех зарегистрированных волонтерских центрах должны быть предзаполнены в БД при запуске приложения.Создание схемы БД и предзаполнение данными необходимо реализовать с использованием liquibase.


## User stories:

1) Как администратор, я хочу авторизоваться с правами администратора, чтобы иметь возможность просмотреть список не занятых волонтеров и их контактные данные.

2) Как администратор, я хочу иметь возможность отправлять сообщения волонтерам, чтобы информировать их о новых возможностях и изменениях.

3) Как пользователь, нужно авторизироваться, чтобы иметь возможность зарегистрироваться в базу волонтеров                                                                                                     

4) Как пользователь, нужно иметь доступ к карте/списку волонтерских центров, чтобы увидеть ближайшие центры или выбрать конкретный для себя

5) Как пользователь, нужно авторизироваться, чтобы иметь возможность отредактировать свой профиль

6) Как пользователь, я хочу получать уведомления о новых волонтерских возможностях, чтобы не пропустить интересные предложения.



### User Case 1: Авторизация администратора

Цель: Реализация серверной логики для авторизации администратора и предоставления токена с правами доступа.
Участники: Администратор.
Предусловия: Учетная запись администратора создана и активирована.
Основной поток:
1.	Ввод email и пароля администратора.
2.	Отправка запроса на сервер.
3.	Получение токена с правами администратора.
4.	Переход на экран управления волонтерами.
Альтернативный поток:
1.	Неверные учетные данные.
2.	Отображение сообщения об ошибке.
3.	Возврат на экран авторизации.

Задачи по User case 1:
Создание эндпоинта для авторизации администратора:
-	Использовать Spring Boot с аннотацией @PostMapping для создания эндпоинта /api/admin/login.
-	Принимать простой JSON-запрос с параметрами email и password (например, {"email": "admin@example.com", "password": "123456"}).

Реализация минимальной проверки данных на сервере:
-	Убедиться, что параметры email и password не пустые.
-	Использовать библиотеку Spring Validation для базовой проверки формата email (аннотация @Email).

Поиск учетной записи администратора в базе данных:
-	Настроить таблицу admins в базе данных H2.
-	Использовать Spring Data JPA для поиска администратора по email (adminRepository.findByEmail(email)).
-	Если учетная запись не найдена, возвращать ошибку с кодом 404 и сообщением "Неверные учетные данные".

Проверка пароля:
-	Пароли хранить в базе данных в открытом виде.
-	Проверять совпадение введенного пароля с паролем из базы данных.

Генерация токена:
-	Пример токена: "token": "a1b2c3d4".

Возвращение токена:
-    При успешной авторизации возвращать HTTP-ответ с кодом 200 и JSON-объект с токеном

Обработка ошибок:
-	Использовать простой try-catch для возврата понятных ошибок, например:
-	Неверный email или пароль – код 401.
-	Некорректный формат email – код 400.

Логирование запросов:
-	Логировать успешные и неуспешные попытки авторизации.

Юнит-тестирование:
-	Написать один тест для успешной авторизации.
-	Один тест для обработки ошибки при неверных данных.
-	Использовать JUnit и стандартный Mockito.




### User Case 2: Отправка сообщений волонтерам

Цель: Реализация серверной логики для отправки сообщений
Участники: Администратор.
Предусловия: Администратор авторизован и имеет доступ к списку волонтеров.
Основной поток:
1.	Переход на экран управления волонтерами.
2.	Выбор одного или нескольких волонтеров из списка.
3.	Ввод текста сообщения.
4.	Отправка сообщения.
5.	Подтверждение успешной отправки.
Альтернативный поток:
1.	Ошибка при отправке сообщения (например, проблемы с подключением к серверу).
2.	Отображение сообщения об ошибке.
3.	Возможность повторной отправки сообщения.


Задачи по User case 2:
-	Создание эндпоинта:
1.	POST /api/volunteers/sendMessage для обработки запроса с параметрами:
2.	volunteers – список ID волонтеров.
3.	message – текст сообщения.

-	Проверка данных: 
1.	Убедиться, что сообщение: Не пустое. 
2.	Не превышает 500 символов. 
3.	Если проверка не пройдена, вернуть ошибку 400.

-	Обработка отправки: Проверить наличие волонтеров в базе данных. При успешной отправке вернуть код 200: При ошибке, вернуть код 510.

-	Повторная отправка:
1.	Эндпоинт POST /api/volunteers/retryMessage для повторной отправки сообщения в случае ошибки.

-	Отмена отправки:
1.	Эндпоинт POST /api/volunteers/cancelMessage для отмены перед отправкой.

-	Логирование:
1.	Логировать все попытки отправки сообщений.

-	Документация:
1.	Добавить описание эндпоинтов в Swagger.

-	Тестирование: 
1.	Написать тесты для успешной отправки и обработки ошибок.


### User Case 3: Авторизация пользователя для регистрации в базе волонтеров

Цель: Реализация серверной логики для авторизации и предоставления токена.
Участники: Пользователь.  
Предусловия: Учетная запись пользователя создана и активирована.

Основной поток:

1. Ввод email и пароля пользователя.
2. Отправка запроса на сервер.
3. Получение токена аутентификации.
4. Переход на экран регистрации в базе волонтеров.

Альтернативный поток:

1. Неверные учетные данные.
2. Отображение сообщения об ошибке.
3. Возврат на экран авторизации.

Задачи по User case 3:

- Реализация проверки введенных данных.

- Отправка данных на сервер (HTTP-запросы). 
- POST /api/user/login для авторизации с параметрами

- Валидация данных: 
- Проверить формат email и длину password

- Поиск пользователя:
- Проверить наличие учетной записи в базе данных.
- Если пользователя нет – вернуть ошибку 401.

- Проверка пароля:
	-  Сравнить хэшированный пароль.

- Генерация токена:
- Создать JWT с ролью user и сроком действия.

- Ответ сервера:
- При успехе вернуть токен с кодом 200.
- В случае ошибки – соответствующий код и сообщение.

- Тестирование:
- Написать тесты для успешной авторизации и ошибок.

### User Case 4: Доступ к карте/списку волонтерских центров

Цель: Реализация логики получения и отображения данных о волонтерских центрах.
Участники: Пользователь.  
Предусловия: Пользователь успешно авторизован в системе.

Основной поток:

1. Переход на экран с картой/списком волонтерских центров.
2. Отображение карты с волонтерскими центрами.
3. Пользователь выбирает интересующий центр для получения подробной информации.

Альтернативный поток:

1. Недоступность данных о центрах.
2. Отображение сообщения об ошибке.
3. Предложение проверить подключение к интернету или повторить попытку позже.

Задачи по User case 4:

- Создать эндпоинт:
- GET /api/centers для получения списка или данных центров.

- Интеграция с внешними сервисами:
- Подключить API картографического сервиса

- Обработка данных:
- Передавать координаты, название и описание центров.
- Обеспечить фильтрацию по местоположению.

- Обработка ошибок:
- При недоступности данных возвращать код 503 с описанием проблемы.

- Тестирование:
- Написать тесты для успешной загрузки и обработки ошибок.

### User Case 5: Редактирование профиля пользователя

Цель: Реализация логики авторизации для доступа к редактированию профиля.  
Участники: Пользователь.  
Предусловия: Учетная запись пользователя создана и активирована.

Основной поток:

1. Ввод email и пароля пользователя.
2. Отправка запроса на сервер.
3. Получение токена аутентификации.
4. Переход на экран редактирования профиля.

Альтернативный поток:

1. Неверные учетные данные.
2. Отображение сообщения об ошибке.
3. Возврат на экран авторизации.

Задачи по User case 5:

- Создать эндпоинт

- Валидация данных:
- Проверить корректность формата и обязательных полей.

- Обновление данных:
- Обновить профиль пользователя в базе.
- Вернуть обновленный объект с кодом 200.

- Обработка ошибок:
- При неверных данных или недоступности сервера возвращать ошибки    400 или 500.

- Тестирование:
- Тесты для проверки валидации, успешного обновления и ошибок.


### User Case 6: Уведомления о новых волонтерских возможностях

Цель: Реализация логики отправки и получения уведомлений для информирования пользователя. 
Участники: Пользователь.  
Предусловия: Пользователь успешно авторизован и уведомления включены.

Основной поток:

1. Подписка на уведомления о волонтерских возможностях.
2. Получение уведомлений в реальном времени при появлении новой возможности.
3. Переход на экран с подробной информацией о возможности.

Альтернативный поток:

1. Проблемы с подключением или недоступность серверов уведомлений.
2. Отображение сообщения о трудностях в получении уведомлений.
3. Возможность повторной попытки через определенный промежуток времени.

Задачи по User case 6:

- Создать эндпоинт:
- для подписки на уведомления 
- для отписки

- Интеграция с сервисом уведомлений:
- Использовать сервис push-уведомлений 
- Настроить токен пользователя для доставки сообщений.

- Обработка новых возможностей:
- При создании новой возможности отправлять уведомления всем подписанным пользователям через push-сервис.
- Передавать информацию: заголовок, краткое описание, ID возможности.

- Обработка ошибок:
- Если push-сервис недоступен, записывать сообщение в очередь для повторной отправки.

- Возвращать код 503 с сообщением при ошибке подписки или отправки.

- Тестирование:
	- Написать тесты для подписки, отписки и доставки уведомлений.

- Настройка управления уведомлениями:
- Обновить настройки пользователя в базе данных
для включения/отключения уведомлений.
- Проверить сохранение предпочтений в профиле.


#### Ссылка на схему БД: 
https://dbdiagram.io/d/679a2061263d6cf9a06712cd