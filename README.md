# Android-Bootcamp-2025-Backend

## Команда: codeHub

## ТЗ

Разработать программный продукт для помощи в осуществлении волонтерской деятельности в клиент-серверной архитектуре.

Клиент - Android Приложение, реализованное на java или kotlin с адаптивной версткой. Мобильное приложение должно предоставлять удобный и интуитивно понятный интерфейс для волонтеров, в котором можно зарегистрироваться в базу волонтеров, просмотреть ближайшие волонтерские центры, отредактировать собственный профиль и посмотреть активных волонтеров в конкретном центре. В случае авторизации с правами администратора, пользователь приложения должен иметь возможность просмотреть список не занятых волонтеров и их контактные данные.

Сервер - микросервис на Spring Boot, работающий с In-memory базой данных H2. Серверное приложение должно предоставлять API необходимый для работы мобильного приложения. Осуществлять все основные манипуляции с данными в СУБД при помощи Spring Data JPA. Данные о всех зарегистрированных волонтерских центрах должны быть предзаполнены в БД при запуске приложения. Создание схемы БД и предзаполнение данными необходимо реализовать с использованием liquibase.

---

## Декомпозиция ТЗ
### User Stories
1. Как **пользователь**, я хочу зарегистрироваться в системе, чтобы находиться в базе волонтеров.
2. Как **пользователь**, я хочу просматривать ближайшие волонтерские центры, чтобы участвовать в волонтерских мероприятиях.
3. Как **пользователь**, я хочу редактировать свой профиль, чтобы поддерживать актуальную информацию о себе.
4. Как **пользователь**, я хочу узнать список волонтеров конкретного центра, чтобы быть осведомленным о волонтерах конкретного центра.
5. Как **администратор**, я хочу просмотреть список не занятых волонтеров, чтобы увидеть их контактные данные.
6. Как **администратор**, я умею удалять профили пользователей, чтобы удалять ненужные аккаунты

### Use Cases
1. **Цель:** Регистрация волонтера
	- **Акторы**: Пользователь
	- **Предусловия**: Учетная запись еще не создана. Пользователь находится на странице регистрации
	- **Основной поток:**
		1. Пользователь вводит в форму "Логин/Email" логин или почту без недопустимых символов
		2. Пользователь нажимает на кнопку "Регистрация"
		3. Данные отправляются на сервер и сохраняются в соответствующие поля в БД
		4. Приложение переходит на страницу с картой
	- **Альтернативный поток:**
		1. Пользователь вводит в поля запрещенные символы (@, [, ], \`, ', ", ~, \_, -, ;, .) или уже существующие данные 
		2. Пользователь нажимает кнопку "Регистрация"
		3. Появляется Toast: "Неверный ввод"

2.  **Цель:** Авторизация волонтера
	- **Акторы**: Пользователь
	- **Предусловия**: Учетная запись создана. Пользователь находится на странице авторизации
	- **Основной поток:**
		1. Пользователь вводит в форму "Логин/Email" логин или почту.
		2. Пользователь нажимает на кнопку "Войти"
		3. Данные проверяются на сервере
		4. Приложение переходит на главный экран
	- **Альтернативный поток:**
		1. Пользователь вводит несуществующие данные
		2. Пользователь нажимает кнопку "Войти"
		3. Toast: "Неверные данные"
	- **Альтернативный поток:**
		1. Пользователь вводит данные и нажимает "Сохранить"
		2. Сеть с сервером отсутствует. Toast: "Ошибка"

3.  **Цель:** Просмотр своего профиля
	- **Акторы**: Пользователь
	- **Предусловия**: Учетная запись создана.
	- **Основной поток:**
		1. Пользователь нажимает на иконку в углу
		2. Приложение получает данные с сервера.
		3. Приложение переходит на страницу профиля
	- **Альтернативный поток.**
		1. Отсутствует сеть с сервером.
		2. Toast: "Ошибка сети

4.  **Цель:** Редактирование профиля пользователя
	- **Акторы**: Пользователь
	- **Предусловия**: Учетная запись создана. Пользователь находится на странице профиля.
	- **Основной поток:**
		1. Пользователь нажимает на кнопку "Редактировать"
		2. Поля с текстом превращаются в поля ввода.
		3. Пользователь вносит изменения в контактные данные или информацию о навыках и предпочтениях и нажимает "Сохранить"
		4. Отправка данных на сервер. Toast: "Сохранено"
	- **Альтернативный поток:**
		1. Пользователь вводит данные и нажимает "Сохранить"
		2. Сеть с сервером отсутствует. Toast: "Ошибка"
	- **Альтернативный поток:**
		 1. Пользователь ввел данные в неправильном формате
		 2. Пользователь нажал "Сохранить"
		 3. Toast: "Неправильный формат"

5.  **Цель:** Удаление своего профиля пользователя
	- **Акторы**: Пользователь
	- **Предусловия**: Учетная запись создана. Пользователь находится на странице своего профиля.
	- **Основной поток:**
		1. Пользователь нажимает на кнопку "Удалить профиль"
		2. Появляется небольшое окно с выбором: "Вы уверены?"
		3. Пользователь выбирает "Да"
		4. Отправка запроса на сервер. Удаление данных с БД.
		5. Перенаправление пользователя на экран авторизации
	- **Альтернативный поток:**
		1. Пользователь выбирает "Нет"
		2. Закрытие появившегося окна
	- **Альтернативный поток:**
		1. Отсутствует сеть с сервером.
		2. Toast: "Ошибка сети"

 6.  **Цель:** Просмотр ближайших волонтерских центров
	 - **Акторы**: Пользователь
	 - **Предусловия**: Учетная запись создана.
	 - **Основной поток**:
        1. Получение местоположения пользователя.
        2. Получение данных волонтерских центров с сервера, сортировка по расстоянию до пользователя.
	 	3. Пользователь находится на карте или выбирает из отсортированного по расстоянию списка волонтерских центров
	 - **Альтернативный поток**:
	 	1. Отсутствует соединение с сервером
	 	2. Вместо списка вывод надписи "Отсутствует соединение с сервером"
	 	3. Попытка получить данные сервера каждые n-секунд
 7.  **Цель:** Поиск волонтерского центра
	 - **Акторы**: Пользователь
	 - **Предусловия**: Учетная запись создана, пользователь просматривает центры списком.
	 - **Основной поток**:
        1. Пользователь нажимает на значок лупы вверху.
        2. Появляется текстовое поле.
        3. Пользователь вводит адресс центра и нажимает найти.
        4. Получение данных с сервера.
        5. Формируется и выводится список найденных центров.
     - **Альтернативный поток**:
	 	1. Отсутствует соединение с сервером
	 	2. Вместо списка вывод надписи "Отсутствует соединение с сервером"
        или
        1. На сервере не найдено ни одного совпадения со введенными данными.
        2. Toast "не найдено"
8.  **Цель:** Просмотр страницы волонтерского центра
	- **Акторы**: Пользователь
	- **Предусловия**: Учетная запись создана. Пользователь нажал на волонтерский центр на карте или в списке ближайших волонтерских центров
	- **Основной поток**:
		1. Загрузка данных волонтерского центра с сервера (без списка волонтеров)
		2. Приложение открывает страницу центра
	- **Альтернативный поток**:
		1. Отсутствует соединение с сервером
		2. Toast: "Отсутствует соединение"

9.  **Цель:** Просмотр списка волонтеров конкретного центра
	- **Акторы**: Пользователь
	- **Предусловия**: Учетная запись создана. Пользователь находится на странице волонтерского центра
	- **Основной поток:**
		1. Пользователь нажимает на кнопку "Список волонтеров"
		2. Получение данных с бд с данными {name} конкретного центра
		3. Приложение открывает список имен волонтеров центра
	- **Альтернативный поток:**
		1. Отсутствует соединение с сервером
		2. Toast: "Отсутствует соединение"

10.  **Цель:** Просмотр списка не занятых волонтеров
	 - **Акторы**: Администратор
	 - **Предусловия**: Учетная запись создана. Пользователь открыл боковую панель
	 - **Основной поток:**
		1. Пользователь нажимает на кнопку "Список не занятых волонтеров"
		2. Получение данных с сервера
		3. Приложение открывает со списком волонтеров и их данными
	 - **Альтернативный поток:**
		1. Отсутствует сеть с сервером.
		2. Toast: "Ошибка сети"

11.  **Цель:** Удаление профиля любого пользователя
	 - **Акторы**: Администратор
	 - **Предусловия**: Учетная запись создана. Администратор находится на странице профиля пользователя
	 - **Основной поток:**
		1. Администратор нажимает на кнопку "Удалить профиль"
		2. Появляется небольшое окно с выбором: "Вы уверены?"
		3. Пользователь выбирает "Да"
		4. Отправка запроса на сервер. Удаление данных с БД.
		5. Перенаправление администратора на экран, с которого он зашел в профиль
	 - **Альтернативный поток:**
		1. Администратор выбирает "Нет"
		2. Закрытие появившегося окна
	 - **Альтернативный поток:**
		1. Отсутствует сеть с сервером.
		2. Toast: "Ошибка сети"

### Задачи backend
1. Реализовать БД H2 с помощью Spring Data JPA:
	- Для пользователя (User) таблица (id, name, phone_number, email, password, status, center_id, isAdmin)
	- Для волонтерских центров (VolunteerCenter) таблица (id, name, location, volunteers, contact)
	- Предзаполнение с помощью Liquibase
1. Для таблицы пользователя:
	- Реализовать хранение паролей в зашифрованном виде
	- Реализовать изменение статуса ("active", "inactive")
	  `PUT /api/users/{id}/status` 
	- Получение статуса ("active", "inactive")
	  `GET /api/users/{id}/status`
1. Для таблицы волонтерских центров:
	- Реализовать создание и редактирование волонтерских центров через API.
2. API для регистрации:
	- `POST /api/users/register`
	  (name, phone_number, email, password)
	- Проверять пароль на запрещенные символы
	- Проверять правильность формата email и уникальность
	- Проверять правильность формата phone_number и уникальность
	- Зашифровать пароль с помощью Spring Security
5. API для авторизации:
	- `POST /api/users/login`
	  (phone_number, email, password)
	- Настроить Spring Security для использования HTTP Basic Auth.
	- При успешной аутентификации выдавать токен или сессию для дальнейших запросов.
	- В случае неверных данных возвращать ошибку \`401 Unauthorized\`.
6. API для получения данных профиля:
	- `GET /api/users/{id}`
	  (name, phone_number, email, status, center_id, isAdmin)
	- Применить валидацию, чтобы только авторизованный пользователь мог получить доступ к своему профилю.
	- Убедиться, что администратор может видеть профили всех пользователей.
7. API для отправления данных о профиле на сервер:
	- `PUT /api/users/{id}/update`
	  (name, phone_number, status, center_id)
	- Провести валидацию данных.
	- Обновить данные в базе данных.
	- Вернуть успешный ответ (`200 OK`), если изменения прошли успешно.
8. API для удаления профиля:
	- `DELETE /api/users/{id}`
	- Гарантировать, что не будет удален профиль администратора
9. API для получения данных волонтерского центра:
	- `GET /api/centers/{id}`
	  (name, location, contact)
10. API для получения списка волонтеров
	- `GET /api/centers/{id}/volunteers`
	  (volunteers)
11. API поиска волонтерских центров по имени и местоположению
	- `GET /api/centers/search/{name}&{location}`
	  (id)
	- Реализовать поиск в базе данных с использованием Spring Data JPA и методов `findByNameContaining` или `findByLocationContaining`, чтобы искать волонтерские центры по частичному совпадению имени или местоположения.
	- Обработать отсутствие результатов поиска

Низкий приоритет:
1. Реализовать возможность редактирования волонтерского центра
2. Реализовать логику удаления волонтерского центра
3. Реализовать систему уведомлений для пользователей

## СХЕМА БАЗЫ ДАННЫХ
https://dbdiagram.io/d/DB-for-VolunteerApp-67992a52263d6cf9a053f0d4

![DB for VolunteerApp](https://github.com/user-attachments/assets/82071fca-3f95-48ff-a00c-78cfcf19ebde)
